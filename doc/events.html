<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <title>SimpleBus/RabbitMQBundleBridge</title>

        <link rel="stylesheet" href="//simplebus.github.io/RabbitMQBundleBridge/css/bootstrap.min.css">
        <link rel="stylesheet" href="//simplebus.github.io/RabbitMQBundleBridge/css/font-awesome.min.css">
        <link rel="stylesheet" href="//simplebus.github.io/RabbitMQBundleBridge/css/highlight.dark.css">
        <link rel="stylesheet" href="//simplebus.github.io/RabbitMQBundleBridge/css/main.css">
    </head>
    <body>

        <header class="navbar navbar-default navbar-fixed-top">

            <a class="navbar-brand" href="//simplebus.github.io/RabbitMQBundleBridge/">
                SimpleBus/RabbitMQBundleBridge
                <small class="hidden-xs hidden-sm">
                    Use OldSoundRabbitMQBundle with SimpleBus/AsynchronousBundle
                </small>
            </a>

            
        </header>

        <main class="container-fluid">
            <div class="row">

                
                    <nav id="sidebar" class="col-sm-3 col-lg-2" role="navigation">

                        <ul class="nav nav-pills nav-stacked">
                                                            <li class="">
                                    <a href="//simplebus.github.io/RabbitMQBundleBridge/">
                                        Home
                                    </a>
                                </li>
                                                            <li class="">
                                    <a href="//simplebus.github.io/RabbitMQBundleBridge/doc/getting_started.html">
                                        Getting started
                                    </a>
                                </li>
                                                            <li class="active">
                                    <a href="//simplebus.github.io/RabbitMQBundleBridge/doc/events.html">
                                        Events
                                    </a>
                                </li>
                                                            <li class="">
                                    <a href="//simplebus.github.io/RabbitMQBundleBridge/doc/routing.html">
                                        Routing
                                    </a>
                                </li>
                                                            <li class="">
                                    <a href="//simplebus.github.io/RabbitMQBundleBridge/doc/additional_properties.html">
                                        Additional properties
                                    </a>
                                </li>
                                                    </ul>

                    </nav>

                
                <section id="content" class="col-sm-offset-3 col-lg-offset-2 col-sm-9 col-lg-10">
                    <h1 id="events">Events</h1>
<h2 id="failure-during-message-consumption">Failure during message consumption</h2>
<p>When an exception is thrown while a <code>Message</code> is being consumed, the exception is not allowed to bubble up so it won't
cause the consumer process to fail. That way, one <code>Message</code> that can't be processed is no danger to any other <code>Message</code>.</p>
<p>The AMQP message containing the <code>Message</code> that caused the failure will be logged, together with the <code>Exception</code> that was
thrown.</p>
<p>If you want to implement some other error handling behaviour (e.g. storing the message to be published again later), you
only need to implement an event subscriber (or listener if you want to) which subscribes to the event
<code>simple_bus.rabbit_mq_bundle_bridge.message_consumption_failed</code>:</p>
<pre><code class="language-php">use SimpleBus\RabbitMQBundleBridge\Event\Events;
use SimpleBus\RabbitMQBundleBridge\Event\MessageConsumptionFailed;
use Symfony\Component\EventDispatcher\EventSubscriberInterface;

class MyErrorHandler implements EventSubscriberInterface
{
    public static function getSubscribedEvents()
    {
        return [Events::MESSAGE_CONSUMPTION_FAILED =&gt; 'messageConsumptionFailed'];
    }

    public function messageConsumptionFailed(MessageConsumptionFailed $event)
    {
        $exception = $event-&gt;exception();
        $amqpMessage = $event-&gt;message();
        ...
    }
}</code></pre>
<p>Don't forget to define a service for it and tag it as <code>kernel.event_subscriber</code>:</p>
<pre><code class="language-yaml">services:
    my_error_handler:
        class: MyErrorHandler
        tags:
            - { name: kernel.event_subscriber }</code></pre>
<h2 id="successful-message-consumption">Successful message consumption</h2>
<p>When a <code>Message</code> has been handled successfully you may want to perform some additional actions. You can do this by
creating an event subscriber which subscribes to the <code>simple_bus.rabbit_mq_bundle_bridge.message_consumed</code> event:</p>
<pre><code class="language-php">use SimpleBus\RabbitMQBundleBridge\Event\Events;
use SimpleBus\RabbitMQBundleBridge\Event\MessageConsumed;
use Symfony\Component\EventDispatcher\EventSubscriberInterface;

class MySuccessHandler implements EventSubscriberInterface
{
    public static function getSubscribedEvents()
    {
        return [Events::MESSAGE_CONSUMED =&gt; 'messageConsumed'];
    }

    public function messageConsumed(MessageConsumed $event)
    {
        $amqpMessage = $event-&gt;message();
        ...
    }
}</code></pre>
<p>Don't forget to define a service for it and tag it as <code>kernel.event_subscriber</code>:</p>
<pre><code class="language-yaml">services:
    my_success_handler:
        class: MySuccessHandler
        tags:
            - { name: kernel.event_subscriber }</code></pre>
                </section>

            </div>
        </main>

        <footer>
            <div class="container-fluid">
                <p class="text-muted">
                    website generated with <a href="http://couscous.io" title="Markdown website generator">Couscous</a>
                </p>
            </div>
        </footer>

        <script src="//code.jquery.com/jquery-1.11.0.min.js"></script>
        <script src="//netdna.bootstrapcdn.com/bootstrap/3.1.1/js/bootstrap.min.js"></script>
        <script src="//yastatic.net/highlightjs/8.2/highlight.min.js"></script>

        <script>
            $(function() {
                $("section>h1").wrap('<div class="page-header" />');
                // Syntax highlighting
                hljs.initHighlightingOnLoad();
            });
        </script>

    </body>
</html>
